<!--
  ~ The contents of this file are subject to the OpenMRS Public License
  ~ Version 1.0 (the "License"); you may not use this file except in
  ~ compliance with the License. You may obtain a copy of the License at
  ~ http://license.openmrs.org
  ~
  ~ Software distributed under the License is distributed on an "AS IS"
  ~ basis, WITHOUT WARRANTY OF ANY KIND, either express or implied. See the
  ~ License for the specific language governing rights and limitations
  ~ under the License.
  ~
  ~ Copyright (C) OpenMRS, LLC.  All Rights Reserved.
-->
<htmlform>
    <style>
        .simple-table {
            border: solid 1px #DDEEEE;
            border-collapse: collapse;
            border-spacing: 0;
            font: normal 13px Arial, sans-serif;
        }

        .simple-table thead th {
            background-color: #DDEFEF;
            border: solid 1px #DDEEEE;
            color: #336B6B;
            padding: 10px;
            text-align: left;
            text-shadow: 1px 1px 1px #fff;
        }

        .simple-table td {
            border: solid 1px #DDEEEE;
            color: #333;
            padding: 10px;
            text-shadow: 1px 1px 1px #fff;
        }
    </style>

    <script type="text/javascript" src="../moduleResources/kenyaemr/scripts/moment.js"></script>
    <script type="text/javascript">
        var ctxPath = typeof openmrsContextPath === 'string' ? openmrsContextPath : OPENMRS_CONTEXT_PATH;
        var patientId = <lookup expression="patient.patientId"/>;
        var pAge = parseInt('<lookup expression="patient.age"/>');
        var CIRCUMCISION_DATE =  "<lookup expression="fn.latestObs(163137).getValueDatetime()"/>";

        //On Ready
        $(document).ready(function () {
            //Defaults
            jq('#tbl-adverse-effects').hide();

            // if none in medications is selected
            jq("#medication-given").show();
            jq("#tbl-medications").show();
            jq('#no-medication :input[type=checkbox]').change(onMedicationSelected);
            jq('#medications-select :input[type=checkbox]').change(noMedicationSelected);

            //Check adverse event type
           // jq("#adverse-event-types select").change(onAdverseEventChange);

            //Check description type
           // jq('#event-description').change(onEventDescriptionChange);

            //Check if any adverse events
            jq("#adverse_events :input[type=radio]").change(onAdverseEventsSelected);

            if (CIRCUMCISION_DATE) {
                var circDate = Date.parse(CIRCUMCISION_DATE);
                displayCirc = calculateDateSinceCircumcision(new Date(circDate));
                jq('#calculated-days-from-circumcision').val(displayCirc);
            }
        });
        // End on ready

        var onMedicationSelected = function(){
            var val = jq(this).val();
            if(val == 1066) {
                jq("#tbl-medications").hide();
            } else {
                jq("#tbl-medications").show();
            }
        }
        var noMedicationSelected = function(){
            var val = jq(this).val();
            var generalExamsChecked = jq("#medications-select input:checkbox:checked");
            if(val == 1107 &amp;&amp; generalExamsChecked.length ==1){
                jq("#tbl-medications").hide();
            }
            if(generalExamsChecked.length ==0){
                jq("#tbl-medications").show();
            }
        }
        //Calculate date since circumcision
        function calculateDateSinceCircumcision(circDate) {
                var today = new Date();
                var encounterDate = Date.parse(getValue('encounter-date.value'));
                var circDateFormatted = circDate.getTime();
                var timeDiff = Math.abs(encounterDate - circDateFormatted);
                daysDiff= Math.floor(timeDiff / (1000 * 60 * 60 * 24));
                return daysDiff;

            }
        var onAdverseEventsSelected = function () {
            getField('adverse_events.error').html('Adverse events should not be empty').hide();
            var val = jq(this).val();
            if(val == 1065 ) {
                jq('#tbl-adverse-effects').show();
            }
            if(val == 1066 ) {
                jq('#tbl-adverse-effects').hide();

            }
        }

        //Clear hidden sections
        clearHiddenSections = function(parentObj) {
            parentObj.find('input[type=radio]').each(function() {
                this.checked = false;
            });
            parentObj.find('input[type=checkbox]').each(function() {
                this.checked = false;
            });
            parentObj.find('input[type=text]').each(function() {
                jq(this).val("");
            });
            parentObj.find('select').each(function() {
                this.selectedIndex =0;
            });
        }
        </script>
    <ifMode mode="EDIT">
        <script type="text/javascript">
            jq(function(){
                var ADVERSE_EFFECT = getValue('adverse_events.value');
                 if(ADVERSE_EFFECT == YES ) {
                    jq('#tbl-adverse-effects').show();
                }

            });
        </script>
    </ifMode>

    <div class="ke-form-header">
        <table style="width: 100%">
            <tr>
                <td align="left">Encounter Date: <encounterDate id="encounter-date" showTime="true"/> </td>
                <td>VMMC Follow-UP Provider : <encounterProvider default="currentUser" /></td>
                <td align="right">Location:<encounterLocation default="GlobalProperty:kenyaemr.defaultLocation" type="autocomplete"/> </td>
            </tr>
        </table>
    </div>

    <div class="ke-form-content">
         <fieldset id="medical-history">
            <legend>Follow-Up Info </legend>
            <table class ="simple-table">
                <tr>
                    <td>
                        Type of Visit:
                    </td>
                    <td>
                        <obs id="visit-type" conceptId="164181AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                              answerConceptIds="1246AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,160101AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                             answerLabels="Scheduled,Unscheduled"
                             style="radio"  />
                    </td>
                 </tr>
                <tr>
                    <td>
                        Day since last circumsicion:
                    </td>
                    <td>
                        <input type="text" name="calculated-days-from-circumcision" id="calculated-days-from-circumcision" readonly="True" />
                    </td>
                </tr>
            </table>
         </fieldset>
        <fieldset id="fs-adverse-event">
            <legend>Adverse Event Post Circumcision </legend>
            <table class ="simple-table">
                <tr>
                    <td>
                        <table id="adverse-event">
                            <tr>
                                <td>
                                    Was there an Adverse Event during circumcision?
                                    <obs id="adverse_events" conceptId="162871AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                                         answerConceptIds="1065AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,1066AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                                         style="radio" />
                                </td>
                            </tr>
                        </table>
                        <table width="100%" id="tbl-adverse-effects" class="simple-table">
                            <tr>
                                <td>Record any Adverse Events that occurred during Circumscision Procedure:</td>
                                <td>
                                    <table>
                                        <tr>
                                            <th>Type of adverse event</th>
                                            <th>Description</th>
                                            <th>Severity</th>
                                        </tr>
                                        <repeat>
                                            <template>
                                                <obsgroup groupingConceptId="121760AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA">
                                                    <tr>
                                                        <td> <obs conceptId="162875AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                                                             answerConceptIds="114403AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,
                                                                               147241AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,
                                                                               152045AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,
                                                                               156567AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,
                                                                               139510AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,
                                                                               118771AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,
                                                                               163799AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                                                            style="dropdown" answerLabels="Pain,
                                                                                    Bleeding,
                                                                                    Problems with appearance,
                                                                                    Hematoma/Swelling,
                                                                                    Infection/Swelling,
                                                                                    Difficulty or pain when urinating,
                                                                                    Wound disruption (without signs of hematoma or infection)"

                                                     id="adverse-event-types" />
                                                </td>
                                                        <td>
                                                            <select name="event-description" class="event-description" id="event-description">
                                                                <option value="none"></option>
                                                                <option value="pain-moderate">Results in disability for 4-7 days</option>
                                                                <option value="pain-severe">Results in disability for more than 7 days</option>
                                                                <option value="bleeding-mild">Dressing soaked through with blood at a routine follow-up visit</option>
                                                                <option value="bleeding-moderate">Bleeding that requires a special return to the clinic for medical attention</option>
                                                                <option value="bleeding-severe">Bleeding that requires surgical re-exploration</option>
                                                                <option value="appearance-mild">May be some concern by client but appearance within normal range</option>
                                                                <option value="appearance-moderate">Scarring, costmetic problem but operation not required</option>
                                                                <option value="appearance-severe">Rotation or other problem,requires cosmetic correction</option>
                                                                <option value="hematoma-mild">More swelling than usual, but no significant discomfort</option>
                                                                <option value="hematoma-moderate">Significant tenderness and discomfort, but surgical re-exploration not required</option>
                                                                <option value="hematoma-severe">Surgical re-exploration required</option>
                                                                <option value="infection-mild">Erythema more than 1 cm beyond incision line</option>
                                                                <option value="infection-moderate">Purulent discharge from the wound</option>
                                                                <option value="infection-severe">Cellulitis or wound necrosis</option>
                                                                <option value="urinating-mild">Transient complaint that resolves without treatment</option>
                                                                <option value="urinating-moderate">Partial obstruction</option>
                                                                <option value="urinating-severe">Cannot urinate</option>
                                                                <option value="disruption-mild">1 to 2 adjascent stitches missing</option>
                                                                <option value="disruption-moderate">Re-stitching of atleast 3 stitches required</option>
                                                                <option value="disruption-severe">Patient incapacitated - bed rest required</option>
                                                            </select>
                                                        </td>
                                                      <td>
                                                    Severity:
                                                    <obs id="severity-level" conceptId="162760AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                                                         answerConceptIds="1500AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,1499AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,1498AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                                                         style="dropdown" answerLabels="Severe,Moderate,Mild" />
                                                  </td>
                                                    </tr>
                                                </obsgroup>
                                            </template>
                                            <render n="1" concept=" " />
                                            <render n="2" concept=" " />
                                            <render n="3" concept=" " />
                                            <render n="4" concept=" " />
                                            <render n="5" concept=" " />
                                        </repeat>
                                    </table>
                                </td>
                            </tr>
                        </table>
                    </td>
                </tr>
            </table>
        </fieldset>
        <fieldset id="fs-adverse-event-management">
            <legend>Adverse Event Management </legend>
                  <table class ="simple-table">
                            <tr>
                                <td>Management of Adverse Events if any:  <br> </br>
                                    <obs conceptId="162749AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" rows="3" cols="80" id="severity_management" />
                                </td>

                            </tr>
                      <tr>
                          <td>
                              <obsgroup groupingConceptId="159392AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA">
                      <tr id="medication-given">
                          <td>Medication given if any:</td>
                          <td>
                              <obs conceptId="159369AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerConceptId="1107AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                                   answerLabel="None" style="checkbox" id="medications-select" /><br/>
                          </td>
                          <td>
                              <table id="tbl-medications" class="simple-table tb1">
                                  <tr>
                                      <td>
                                          <obs conceptId="159369AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerConceptId="103294AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                                               answerLabel="Analgesic" style="checkbox" /><br/>
                                      </td>
                                      <td>
                                          <obs conceptId="159369AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerConceptId="1195AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                                               answerLabel="Antibiotics" style="checkbox" /><br/>
                                      </td>
                                      <td>
                                          <obs conceptId="159369AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerConceptId="84879AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                                               answerLabel="TTCV" style="checkbox" /><br/>
                                      </td>
                                      <td>
                                          <obs conceptId="159369AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" answerConceptId="5622AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                                               answerLabel="Other" style="checkbox" /><br/>
                                      </td>
                                      <td> Specify: </td>
                                      <td>
                                          <obs id="other-medication" conceptId="161011AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" size="50"/>
                                      </td>
                                  </tr>
                              </table>
                          </td>
                      </tr>
                      </obsgroup>

                      </td>
                      </tr>
                      <tr>
                          <td>Client Reviewed and Discharged by: </td>
                          <td> <obs conceptId="1473AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" id="discharged-by"  /> </td>
                      </tr>
                      <tr>
                          <td>Cadre: </td>
                          <td>
                              <obs conceptId="1542AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                                   answerConceptIds="162591AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,162592AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA,1577AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                                   answerLabels="MO,CO,Nurse" id="clinician_cadre" style="radio" />
                          </td>
                      </tr>
                      <tr>
                          <td>
                              <obs conceptId="160632AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" rows="3" cols="80" id="clinical-notes"/>
                          </td>
                      </tr>

                  </table>

        </fieldset>
        </div>
    <div class="ke-form-footer">
        <submit/>
    </div>

</htmlform>